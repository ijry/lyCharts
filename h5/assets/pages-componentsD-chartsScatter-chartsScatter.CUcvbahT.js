import{_ as t,c as e,o as a,w as s,a as i,p as r,q as c,i as n,e as o,f as h,b as l,d}from"./index-CXOIyyAn.js";import{c as u}from"./chartHelper.WSh08z7V.js";const m=t({name:"u-charts-scatter",props:{option:{type:Object,default:()=>({})},height:{type:[String,Number],default:400},width:{type:[String,Number],default:"100%"}},data:()=>({canvasId:"scatter-chart-"+Date.now(),ctx:null,canvasWidth:0,canvasHeight:0,grid:{top:10,right:20,bottom:25,left:50},seriesData:[],touchInfo:{startX:0,startY:0}}),computed:{containerHeight(){return"number"==typeof this.height?this.height+"px":this.height},containerWidth(){return"number"==typeof this.width?this.width+"px":this.width}},watch:{option:{handler(t){this.drawChart(t)},deep:!0}},mounted(){this.$nextTick(()=>{this.initCanvas()})},methods:{initCanvas(){try{uni.createSelectorQuery().in(this).select("#"+this.canvasId).boundingClientRect(t=>{if(t){if(this.canvasWidth=t.width,this.canvasHeight=t.height,this.ctx=uni.createCanvasContext(this.canvasId,this),!this.ctx)return void console.error("无法获取canvas绘图上下文");this.drawChart(this.option)}else console.error("无法获取canvas信息")}).exec()}catch(t){console.error("初始化canvas失败:",t)}},drawChart(t){if(this.ctx&&t)try{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.backgroundColor&&(this.ctx.setFillStyle(t.backgroundColor),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight));let e=0;t.title&&t.title.text&&(e=u.drawTitle(this.ctx,t.title,this.canvasWidth)),e>0&&(this.grid.top=Math.max(this.grid.top,e+10));const a=t.series||[],s=t.xAxis||{},i=t.yAxis||{},{minX:r,maxX:c,minY:n,maxY:o}=this.calculateScatterDataRange(a);let h=0;if(t.legend&&t.legend.data){const s=a.map(t=>t.name),i={...t.legend,data:s};h=u.drawLegend(this.ctx,i,this.grid,this.canvasWidth,u.defaultColors,this.canvasHeight,e)}!1!==t.grid&&u.drawGrid(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,5,n,o,!0),u.drawAxis(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,[r,(r+c)/2,c],n,o,s,i,"scatter"),this.drawScatterSeries(a,r,c,n,o),this.ctx.draw()}catch(e){console.error("绘制图表失败:",e)}},calculateScatterDataRange(t){let e=Number.MAX_VALUE,a=Number.MIN_VALUE,s=Number.MAX_VALUE,i=Number.MIN_VALUE;if(!t||!Array.isArray(t))return{minX:0,maxX:1,minY:0,maxY:1};let r=!1;if(t.forEach(t=>{t&&"scatter"===t.type&&t.data&&Array.isArray(t.data)&&t.data.forEach(t=>{if(Array.isArray(t)&&t.length>=2){const c=t[0],n=t[1];"number"!=typeof c||isNaN(c)||"number"!=typeof n||isNaN(n)||(c<e&&(e=c),c>a&&(a=c),n<s&&(s=n),n>i&&(i=n),r=!0)}})}),!r)return{minX:0,maxX:1,minY:0,maxY:1};const c=a-e,n=i-s;if(0===c)e-=1,a+=1;else{const t=.1*c;e-=t,a+=t}if(0===n)s-=1,i+=1;else{const t=.1*n;s-=t,i+=t}return{minX:e,maxX:a,minY:s,maxY:i}},drawScatterSeries(t,e,a,s,i){if(!t||0===t.length)return;const r=this.canvasWidth-this.grid.left-this.grid.right,c=this.canvasHeight-this.grid.top-this.grid.bottom;this.seriesData=[],t.forEach((t,n)=>{var o;if("scatter"!==t.type)return;const h=t.color||(null==(o=t.itemStyle)?void 0:o.color)||u.getColor(n),l=t.symbolSize||10,d=[];t.data&&Array.isArray(t.data)&&t.data.forEach((o,h)=>{if(Array.isArray(o)&&o.length>=2){const h=o[0],l=o[1],u=this.grid.left+(h-e)/(a-e||1)*r,m=this.grid.top+c-(l-s)/(i-s||1)*c;d.push({x:u,y:m,value:[h,l],name:o[2]||`(${h}, ${l})`,seriesName:t.name||`Series ${n}`})}}),this.seriesData.push({name:t.name||`Series ${n}`,points:d,color:h}),d.length>0&&(this.ctx.setFillStyle(h),d.forEach(e=>{this.drawSymbol(e.x,e.y,l,t.symbol||"circle")}))})},drawSymbol(t,e,a,s){switch(this.ctx.beginPath(),s){case"circle":default:this.ctx.arc(t,e,a/2,0,2*Math.PI);break;case"rect":this.ctx.rect(t-a/2,e-a/2,a,a);break;case"triangle":const s=a*Math.sqrt(3)/2;this.ctx.moveTo(t,e-s/2),this.ctx.lineTo(t-a/2,e+s/2),this.ctx.lineTo(t+a/2,e+s/2),this.ctx.closePath();break;case"diamond":this.ctx.moveTo(t,e-a/2),this.ctx.lineTo(t-a/2,e),this.ctx.lineTo(t,e+a/2),this.ctx.lineTo(t+a/2,e),this.ctx.closePath()}this.ctx.fill()},handleTouchStart(t){if(t.touches&&t.touches.length>0){const e=t.touches[0];this.touchInfo.startX=e.x||0,this.touchInfo.startY=e.y||0}},handleTouchMove(t){t.preventDefault&&t.preventDefault()},handleTouchEnd(t){if(t.changedTouches&&t.changedTouches.length>0){const e=t.changedTouches[0],a=e.x||0,s=e.y||0,i=Math.abs(a-this.touchInfo.startX),r=Math.abs(s-this.touchInfo.startY);i<5&&r<5&&this.handleChartClick(a,s)}},handleChartClick(t,e){let a=1/0,s=null;this.seriesData&&this.seriesData.length>0&&this.seriesData.forEach(i=>{i.points&&i.points.length>0&&i.points.forEach(r=>{const c=Math.sqrt(Math.pow(r.x-t,2)+Math.pow(r.y-e,2));c<a&&c<20&&(a=c,s={seriesName:i.name,name:r.name,value:r.value,color:i.color,x:r.x,y:r.y})})}),s&&this.$emit("click",{componentType:"series",seriesType:"scatter",seriesName:s.seriesName,name:s.name,value:s.value,color:s.color,event:{offsetX:s.x,offsetY:s.y}})},setOption(t,e=!1){if(e)this.drawChart(t);else try{const e=JSON.parse(JSON.stringify(this.option));Object.assign(e,t),this.drawChart(e)}catch(a){console.error("合并配置失败:",a),this.drawChart(t)}},resize(){this.initCanvas()}}},[["render",function(t,o,h,l,d,u){const m=r,p=n;return a(),e(p,{class:"u-charts-scatter",style:c({width:u.containerWidth,height:u.containerHeight})},{default:s(()=>[i(m,{class:"chart-canvas",id:d.canvasId,"canvas-id":d.canvasId,onTouchstart:u.handleTouchStart,onTouchmove:u.handleTouchMove,onTouchend:u.handleTouchEnd},null,8,["id","canvas-id","onTouchstart","onTouchmove","onTouchend"])]),_:1},8,["style"])}],["__scopeId","data-v-ba1ab3f4"]]);const p=t({data:()=>({basicScatterOption:{title:{text:"基本散点图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"value"},yAxis:{type:"value"},series:[{name:"销量",type:"scatter",data:[[10,8.04],[8,6.95],[13,7.58],[9,8.81],[11,8.33],[14,9.96],[6,7.24],[4,4.26],[12,10.84],[7,4.82],[5,5.68]],symbolSize:15}]},multiScatterOption:{title:{text:"多系列散点图",textStyle:{fontSize:16,color:"#333"}},legend:{data:["系列1","系列2"]},xAxis:{type:"value"},yAxis:{type:"value"},series:[{name:"系列1",type:"scatter",data:[[161,51],[167,59],[159,49],[157,63],[155,53],[170,59],[159,47],[166,69],[176,66],[160,75]],symbolSize:15},{name:"系列2",type:"scatter",data:[[175,75],[180,80],[170,70],[178,82],[176,78],[183,85],[179,81],[185,88],[172,72],[177,79]],symbolSize:15}]},symbolScatterOption:{title:{text:"不同符号散点图",textStyle:{fontSize:16,color:"#333"}},legend:{data:["圆形","方形","三角形","菱形"]},xAxis:{type:"value"},yAxis:{type:"value"},series:[{name:"圆形",type:"scatter",symbol:"circle",symbolSize:15,data:[[10,8.04],[8,6.95],[13,7.58],[9,8.81],[11,8.33]]},{name:"方形",type:"scatter",symbol:"rect",symbolSize:15,data:[[14,9.96],[6,7.24],[4,4.26],[12,10.84],[7,4.82]]},{name:"三角形",type:"scatter",symbol:"triangle",symbolSize:15,data:[[15,6.5],[12.5,7.2],[11.5,6.8],[13.5,8.1],[10.5,5.9]]},{name:"菱形",type:"scatter",symbol:"diamond",symbolSize:15,data:[[9.5,9.2],[7.5,6.1],[14.5,8.7],[8.5,7.9],[11.5,9.5]]}]}}),methods:{onChartClick(t){console.log("点击了散点图:",t)}}},[["render",function(t,r,c,u,p,y){const g=l,x=o(h("ly-charts-scatter"),m),f=n;return a(),e(f,{class:"u-page"},{default:s(()=>[i(f,{class:"u-page__item"},{default:s(()=>[i(g,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("基本散点图")]),_:1}),i(f,{class:"u-page__item__content"},{default:s(()=>[i(x,{ref:"basicScatter",option:p.basicScatterOption,width:"700rpx",height:"260px",onClick:y.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(f,{class:"u-page__item"},{default:s(()=>[i(g,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("多系列散点图")]),_:1}),i(f,{class:"u-page__item__content"},{default:s(()=>[i(x,{ref:"multiScatter",option:p.multiScatterOption,width:"700rpx",height:"260px",onClick:y.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(f,{class:"u-page__item"},{default:s(()=>[i(g,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("不同符号散点图")]),_:1}),i(f,{class:"u-page__item__content"},{default:s(()=>[i(x,{ref:"symbolScatter",option:p.symbolScatterOption,width:"700rpx",height:"260px",onClick:y.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-7b83be2c"]]);export{p as default};
