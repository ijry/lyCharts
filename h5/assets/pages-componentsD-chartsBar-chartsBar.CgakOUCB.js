import{_ as t,c as e,o as a,w as o,a as i,p as r,q as s,i as l,e as n,f as c,b as h,d}from"./index-D2lOTBej.js";import{c as u}from"./chartHelper.WSh08z7V.js";const p=t({name:"up-charts-bar",props:{option:{type:Object,default:()=>({})},height:{type:[String,Number],default:400},width:{type:[String,Number],default:"100%"}},data:()=>({canvasId:"bar-chart-"+Date.now(),ctx:null,canvasWidth:0,canvasHeight:0,grid:{top:10,right:20,bottom:25,left:50},seriesData:[],touchInfo:{startX:0,startY:0}}),computed:{containerHeight(){return"number"==typeof this.height?this.height+"px":this.height},containerWidth(){return"number"==typeof this.width?this.width+"px":this.width}},watch:{option:{handler(t){this.drawChart(t)},deep:!0}},mounted(){this.$nextTick(()=>{this.initCanvas()})},methods:{initCanvas(){try{uni.createSelectorQuery().in(this).select("#"+this.canvasId).boundingClientRect(t=>{if(t){if(this.canvasWidth=t.width,this.canvasHeight=t.height,this.ctx=uni.createCanvasContext(this.canvasId,this),!this.ctx)return void console.error("无法获取canvas绘图上下文");this.drawChart(this.option)}else console.error("无法获取canvas信息")}).exec()}catch(t){console.error("初始化canvas失败:",t)}},drawChart(t){if(this.ctx&&t)try{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.backgroundColor&&(this.ctx.setFillStyle(t.backgroundColor),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight));let e=0;t.title&&t.title.text&&(e=u.drawTitle(this.ctx,t.title,this.canvasWidth)),e>0&&(this.grid.top=Math.max(this.grid.top,e+10));const a=t.series||[],o=t.xAxis||{},i=t.yAxis||{},r=u.processXAxisData(o,a),{minY:s,maxY:l}=this.calculateStackedDataRange(a),n=void 0!==t.xAxisPadding?t.xAxisPadding:10;let c=0;if(t.legend&&t.legend.data){const o={...t.legend},i=a.map((t,e)=>{var a;return t.color||(null==(a=t.itemStyle)?void 0:a.color)||u.getColor(e)});c=u.drawLegend(this.ctx,o,this.grid,this.canvasWidth,i,this.canvasHeight,e)}!1!==t.grid&&u.drawGrid(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,r.length,s,l,!1,n),u.drawAxis(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,r,s,l,o,i,"bar",n),this.drawBars(a,r,s,l,u.adjustedYMin,u.adjustedYMax,n),this.ctx.draw()}catch(e){console.error("绘制图表失败:",e)}},drawMountainBar(t,e,a,o,i,r,s,l){var n,c;t.beginPath(),t.setFillStyle(r);const h=(this.canvasWidth-this.grid.left-this.grid.right)/((null==(c=null==(n=this.option.xAxis)?void 0:n.data)?void 0:c.length)||1),d=.3*o,u=e-(h-o)/2,p=e+(o-d)/2;t.moveTo(p+d/2,a),t.lineTo(u,a+i),t.lineTo(u+h,a+i),t.lineTo(p+d/2,a),t.closePath(),t.fill(),l>0&&s&&(t.setLineWidth(l),t.setStrokeStyle(s),t.stroke())},drawRoundedMountainBar(t,e,a,o,i,r,s,l){t.beginPath(),t.setFillStyle(r);const n=4*o,c=5*o,h=e-(n-o)/2,d=e+(o-c)/2,u=a+i,p=a;t.moveTo(h,u),t.bezierCurveTo(h+.4*n,u-.2*i,d+.3*c,p+.2*i,d+.5*c,p+.2*i),t.bezierCurveTo(d+.7*c,p+.2*i,h+.6*n,u-.2*i,h+n,u),t.closePath(),t.fill(),l>0&&s&&(t.setLineWidth(l),t.setStrokeStyle(s),t.stroke())},drawSharpMountainBar(t,e,a,o,i,r,s,l){t.beginPath(),t.setFillStyle(r);const n=4*o,c=.1*o,h=e-(n-o)/2,d=e+(o-c)/2,u=a+i,p=a;t.moveTo(h,u),t.bezierCurveTo(h+.4*n,u-.2*i,d+.3*c,p+.2*i,d+.5*c,p),t.bezierCurveTo(d+.7*c,p+.2*i,h+.6*n,u-.2*i,h+n,u),t.closePath(),t.fill(),l>0&&s&&(t.setLineWidth(l),t.setStrokeStyle(s),t.stroke())},drawRealMountainBar(t,e,a,o,i,r,s,l){t.beginPath(),t.setFillStyle(r);const n=4*o,c=2*o,h=e-(n-o)/2,d=e+(o-c)/2,u=a+i,p=a;t.moveTo(h,u),t.bezierCurveTo(h+.3*n,u-.3*i,d+.2*c,p+.3*i,d+.4*c,p+.1*i),t.bezierCurveTo(d+.5*c,p,d+.6*c,p+.1*i,d+.8*c,p+.3*i),t.bezierCurveTo(d+.9*c,p+.4*i,h+.7*n,u-.3*i,h+n,u),t.closePath(),t.fill(),l>0&&s&&(t.setLineWidth(l),t.setStrokeStyle(s),t.stroke())},drawRoundedBar(t,e,a,o,i,r,s,l,n){const c=n||Math.min(o/2,i/2);t.beginPath(),t.setFillStyle(r),t.moveTo(e+c,a),t.lineTo(e+o-c,a),t.arcTo(e+o,a,e+o,a+c,c),t.lineTo(e+o,a+i-c),t.arcTo(e+o,a+i,e+o-c,a+i,c),t.lineTo(e+c,a+i),t.arcTo(e,a+i,e,a+i-c,c),t.lineTo(e,a+c),t.arcTo(e,a,e+c,a,c),t.closePath(),t.fill(),l>0&&s&&(t.setLineWidth(l),t.setStrokeStyle(s),t.stroke())},drawBars(t,e,a,o,i,r,s=10){const l=this.canvasWidth-this.grid.left-this.grid.right-2*s,n=this.canvasHeight-this.grid.top-this.grid.bottom;this.seriesData=[];const c=void 0!==i&&void 0!==r,h=c?i:a,d=c?r:o,p=h<0?h:0,b=new Map;t.forEach((t,e)=>{"bar"===t.type&&t.stack&&(b.has(t.stack)||b.set(t.stack,[]),b.get(t.stack).push({serie:t,index:e}))});const g=b.size+t.filter(t=>"bar"===t.type&&!t.stack).length,y=l-20*(e.length-1),m=g>0?Math.max(1,y/e.length):0,x=new Map;let f=0;b.forEach((t,e)=>{x.set(e,{groupIndex:f++,isStack:!0,seriesList:t})}),t.forEach((t,e)=>{"bar"===t.type&&(t.stack||x.set(e,{groupIndex:f++,isStack:!1,seriesList:[{serie:t,index:e}]}))});const S=new Map;t.forEach((t,a)=>{var o;if("bar"!==t.type)return;const i=t.color||(null==(o=t.itemStyle)?void 0:o.color)||u.getColor(a),r=t.barWidth||Math.min(20,m/(g||1)),c=t.symbol||"rect";let h;h=t.stack?x.get(t.stack):x.get(a),S.has(h.groupIndex)||S.set(h.groupIndex,new Array(e.length).fill(0));const b=[];t.data.forEach((a,o)=>{var u,y,m,x,f,_,v;const k="object"==typeof a&&null!==a&&void 0!==a.value?a.value:a;let C;const M=l/Math.max(e.length,1),T=this.grid.left+s+o*M;if(h.isStack)C=T+(M-r)/2;else{const t=g||1,e=.1*r;C=T+(M-(r*t+e*(t-1)))/2+h.groupIndex*(r+e)}const W=this.grid.top+n-(0-p)/(d-p||1)*n;let z,w;if(h.isStack){const t=S.get(h.groupIndex),e=t[o],a=this.grid.top+n-(e-p)/(d-p||1)*n,i=this.grid.top+n-(e+k-p)/(d-p||1)*n;z=i,w=Math.abs(a-i),t[o]=e+k}else z=this.grid.top+n-(k-p)/(d-p||1)*n,w=Math.abs(z-W);const B="object"==typeof a&&null!==a&&(null==(u=a.itemStyle)?void 0:u.color)?a.itemStyle.color:"object"==typeof a&&null!==a&&a.color?a.color:i;let R=(null==(y=t.itemStyle)?void 0:y.borderColor)||null,A=(null==(m=t.itemStyle)?void 0:m.borderWidth)||0,E=(null==(x=t.itemStyle)?void 0:x.borderRadius)||0;"object"==typeof a&&null!==a&&(R=(null==(f=a.itemStyle)?void 0:f.borderColor)||a.borderColor||R,A=(null==(_=a.itemStyle)?void 0:_.borderWidth)||a.borderWidth||A,E=(null==(v=a.itemStyle)?void 0:v.borderRadius)||a.borderRadius||E),b.push({x:C,y:k>=0||h.isStack?z:W,value:k,name:e[o],seriesName:t.name,barHeight:w,zeroY:W,barWidth:r,symbol:c,color:B,borderColor:R,borderWidth:A,borderRadius:E})}),this.seriesData.push({name:t.name,points:b,color:i}),b.forEach((t,e)=>{let a=t.color;switch(a&&(a!==i||"mountain"!==t.symbol&&"realMountain"!==t.symbol&&"roundedMountain"!==t.symbol&&"sharpMountain"!==t.symbol)||(a=u.defaultColors[e%u.defaultColors.length]),t.symbol){case"mountain":this.drawMountainBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth);break;case"roundedMountain":this.drawRoundedMountainBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth);break;case"realMountain":this.drawRealMountainBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth);break;case"sharpMountain":this.drawSharpMountainBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth);break;case"rounded":this.drawRoundedBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth);break;default:if(t.borderRadius&&t.borderRadius>0)this.drawRoundedBar(this.ctx,t.x,t.value>=0||h.isStack?t.y:t.zeroY,t.barWidth,t.barHeight,a||t.color,t.borderColor,t.borderWidth,t.borderRadius);else{this.ctx.setFillStyle(a||t.color);const e=t.value>=0||h.isStack?t.y:t.zeroY;this.ctx.fillRect(t.x,e,t.barWidth,t.barHeight),!h.isStack&&t.borderWidth>0&&t.borderColor&&(this.ctx.setLineWidth(t.borderWidth),this.ctx.setStrokeStyle(t.borderColor),this.ctx.strokeRect(t.x,e,t.barWidth,t.barHeight))}}})}),b.forEach(t=>{var e,a;if(t.length>0){const o=t[0].serie,i=(null==(e=o.itemStyle)?void 0:e.borderColor)||null,r=(null==(a=o.itemStyle)?void 0:a.borderWidth)||0;r>0&&i&&t.forEach(({serie:e,index:a})=>{const o=x.get(e.stack);e.data.forEach((e,s)=>{const l=this.seriesData[a].points;if(l&&l[s]){const e=l[s];if(a===t[t.length-1].index){const t=S.get(o.groupIndex)[s],a=Math.abs(t/(d-p||1)*n),l=this.grid.top+n-(t-p)/(d-p||1)*n;this.ctx.setLineWidth(r),this.ctx.setStrokeStyle(i),this.ctx.strokeRect(e.x,l,e.barWidth,a)}}})})}})},handleTouchStart(t){if(t.touches&&t.touches.length>0){const e=t.touches[0];this.touchInfo.startX=e.x||0,this.touchInfo.startY=e.y||0}},handleTouchMove(t){t.preventDefault&&t.preventDefault()},handleTouchEnd(t){if(t.changedTouches&&t.changedTouches.length>0){const e=t.changedTouches[0],a=e.x||0,o=e.y||0,i=Math.abs(a-this.touchInfo.startX),r=Math.abs(o-this.touchInfo.startY);i<5&&r<5&&this.handleChartClick(a,o)}},handleChartClick(t,e){let a=1/0,o=null;this.seriesData.forEach(i=>{i.points.forEach(r=>{const s=r.barWidth||20;if(t>=r.x&&t<=r.x+s&&e>=Math.min(r.y,r.zeroY)&&e<=Math.min(r.y,r.zeroY)+r.barHeight){const s=Math.sqrt(Math.pow(r.x-t,2)+Math.pow(r.y-e,2));s<a&&(a=s,o={seriesName:i.name,name:r.name,value:r.value,color:i.color,x:r.x,y:r.y})}})}),o&&this.$emit("click",{componentType:"series",seriesType:"bar",seriesName:o.seriesName,name:o.name,value:o.value,color:o.color,event:{offsetX:o.x,offsetY:o.y}})},setOption(t,e=!1){if(e)this.drawChart(t);else{const e=JSON.parse(JSON.stringify(this.option));Object.assign(e,t),this.drawChart(e)}},resize(){this.initCanvas()},calculateStackedDataRange(t){let e=0,a=0;const o=new Map,i=[];return t.forEach(t=>{"bar"===t.type&&(t.stack?(o.has(t.stack)||o.set(t.stack,[]),o.get(t.stack).push(t)):i.push(t))}),i.forEach(t=>{t.data.forEach(t=>{const o="object"==typeof t?t.value:t;e=Math.min(e,o),a=Math.max(a,o)})}),o.forEach(t=>{const o=new Map;t.forEach(t=>{t.data.forEach((t,e)=>{const a="object"==typeof t?t.value:t;o.has(e)||o.set(e,0),o.set(e,o.get(e)+a)})}),o.forEach(t=>{e=Math.min(e,t),a=Math.max(a,t)})}),e=Math.min(e,0),a=Math.max(a,0),{minY:e,maxY:a}}}},[["render",function(t,n,c,h,d,u){const p=r,b=l;return a(),e(b,{class:"up-charts-bar",style:s({width:u.containerWidth,height:u.containerHeight})},{default:o(()=>[i(p,{class:"chart-canvas",id:d.canvasId,"canvas-id":d.canvasId,onTouchstart:u.handleTouchStart,onTouchmove:u.handleTouchMove,onTouchend:u.handleTouchEnd},null,8,["id","canvas-id","onTouchstart","onTouchmove","onTouchend"])]),_:1},8,["style"])}],["__scopeId","data-v-e21c945b"]]);const b=t({data:()=>({barOption:{title:{text:"销售数据统计",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销售额",type:"bar",data:[120,200,150,80,70,110,130],itemStyle:{color:"#5470c6"}},{name:"订单量",type:"bar",data:[60,80,90,50,40,70,85],itemStyle:{color:"#91cc75"}}],legend:{top:0,data:["销售额","订单量"],textStyle:{color:"#666"}},backgroundColor:"transparent"},barOptionStack:{title:{text:"销售数据统计",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销售额",type:"bar",stack:"order",data:[120,200,150,80,70,110,130],itemStyle:{color:"#5470c6"}},{name:"订单量",type:"bar",stack:"order",data:[60,80,90,50,40,70,85],itemStyle:{color:"#91cc75"}}],legend:{bottom:0,data:["销售额","订单量"],textStyle:{color:"#666"}},backgroundColor:"transparent"},barOptionThermometer:{title:{text:"温度计形柱状图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",stack:"order",data:[120,180,150,90,110],itemStyle:{color:"#94C973",borderColor:"#3992DE",borderWidth:1}},{name:"订单量",type:"bar",stack:"order",data:[60,80,90,50,40,70,85],itemStyle:{color:"rgba(142, 230, 157, 0.4)"}}],legend:{top:0,data:["销量","订单量"],textStyle:{color:"#666"}},backgroundColor:"transparent"},barOptionRounded:{title:{text:"圆角柱状图示例",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",data:[120,180,150,{value:80,itemStyle:{color:"#ff6b6b",borderColor:"#b56bff",borderWidth:1}},110],itemStyle:{color:"#2ed573",borderRadius:10}}],legend:{top:0,data:["销量"],textStyle:{color:"#666"}},backgroundColor:"transparent"},barOptionMountain:{title:{text:"山峰图示例",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",symbol:"mountain",data:[120,180,150,90,110],itemStyle:{color:"#5470c6"}}],backgroundColor:"transparent"},barOptionRoundedMountain:{title:{text:"圆角山峰图示例",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",symbol:"roundedMountain",data:[120,180,150,{value:90,itemStyle:{color:"#1990FF"}},110],itemStyle:{color:"#91cc75"}}],backgroundColor:"transparent"},barOptionRealMountain:{title:{text:"自然山峰图示例",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",symbol:"realMountain",data:[120,180,150,{value:90,itemStyle:{color:"#1990FF"}},110],itemStyle:{color:"#91cc75"}}],backgroundColor:"transparent"},barOptionSharpMountain:{title:{text:"尖角山峰图示例",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["产品A","产品B","产品C","产品D","产品E"],axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{color:"#666",fontSize:12}},series:[{name:"销量",type:"bar",symbol:"sharpMountain",data:[120,180,150,90,110],itemStyle:{color:"#fac858"}}],backgroundColor:"transparent"}}),methods:{handleBarClick(t){this.$refs.uToast.show({title:`${t.seriesName} - ${t.name}: ${t.value}`,type:"success"})}}},[["render",function(t,r,s,u,b,g){const y=h,m=n(c("ly-charts-bar"),p),x=l;return a(),e(x,{class:"u-page"},{default:o(()=>[i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("基础使用")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBar",option:b.barOption,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("堆叠示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarStack",option:b.barOptionStack,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("温度计形图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarThermometer",option:b.barOptionThermometer,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("圆角柱状图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarRounded",option:b.barOptionRounded,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("山峰图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarMountain",option:b.barOptionMountain,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("圆角山峰图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarRoundedMountain",option:b.barOptionRoundedMountain,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("尖角山峰图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarSharpMountain",option:b.barOptionSharpMountain,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1}),i(x,{class:"u-page__item"},{default:o(()=>[i(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:o(()=>[d("自然山峰图示例")]),_:1}),i(x,{class:"u-page__item__content"},{default:o(()=>[i(m,{ref:"uChartsBarRealMountain",option:b.barOptionRealMountain,height:220,onClick:g.handleBarClick},null,8,["option","onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-56bac17e"]]);export{b as default};
