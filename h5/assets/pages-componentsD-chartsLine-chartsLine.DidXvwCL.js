import{_ as t,c as e,o as i,w as a,a as s,p as h,q as n,i as o,e as r,f as l,b as c,d}from"./index-Dpn2HO60.js";import{c as g}from"./chartHelper.WSh08z7V.js";const x=t({name:"u-charts-line",props:{option:{type:Object,default:()=>({})},height:{type:[String,Number],default:400},width:{type:[String,Number],default:"100%"}},data:()=>({canvasId:"line-chart-"+Date.now(),ctx:null,canvasWidth:0,canvasHeight:0,grid:{top:10,right:20,bottom:25,left:50},seriesData:[],touchInfo:{startX:0,startY:0}}),computed:{containerHeight(){return"number"==typeof this.height?this.height+"px":this.height},containerWidth(){return"number"==typeof this.width?this.width+"px":this.width}},watch:{option:{handler(t){this.drawChart(t)},deep:!0}},mounted(){this.$nextTick(()=>{this.initCanvas()})},methods:{initCanvas(){try{uni.createSelectorQuery().in(this).select("#"+this.canvasId).boundingClientRect(t=>{if(t){if(this.canvasWidth=t.width,this.canvasHeight=t.height,this.ctx=uni.createCanvasContext(this.canvasId,this),!this.ctx)return void console.error("无法获取canvas绘图上下文");this.drawChart(this.option)}else console.error("无法获取canvas信息")}).exec()}catch(t){console.error("初始化canvas失败:",t)}},drawChart(t){if(this.ctx&&t)try{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.backgroundColor&&(this.ctx.setFillStyle(t.backgroundColor),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight));let e=0;t.title&&t.title.text&&(e=g.drawTitle(this.ctx,t.title,this.canvasWidth)),e>0&&(this.grid.top=Math.max(this.grid.top,e+10));const i=t.series||[],a=t.xAxis||{},s=t.yAxis||{},h=g.processXAxisData(a,i),{minY:n,maxY:o}=g.calculateDataRange(i),r=t.xAxisPadding||0;let l=0;if(t.legend&&t.legend.data){const i={...t.legend};l=g.drawLegend(this.ctx,i,this.grid,this.canvasWidth,g.defaultColors,this.canvasHeight,e)}!1!==t.grid&&g.drawGrid(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,h.length,n,o,!0,r),g.drawAxis(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,h,n,o,a,s,"line",r),this.drawSeries(i,h,n,o,g.adjustedYMin,g.adjustedYMax,r),this.ctx.draw()}catch(e){console.error("绘制图表失败:",e)}},drawSeries(t,e,i,a,s,h,n=0){if(!t||0===t.length)return;const o=this.canvasWidth-this.grid.left-this.grid.right-2*n,r=this.canvasHeight-this.grid.top-this.grid.bottom;this.seriesData=[];const l=void 0!==s&&void 0!==h,c=l?s:i,d=l?h:a;t.forEach((t,i)=>{var a;if("line"!==t.type)return;const s=t.color||(null==(a=t.itemStyle)?void 0:a.color)||g.getColor(i),h=(null==t?void 0:t.areaStyle)||t.fillArea,l=!0===t.smooth,x=[];t.data&&Array.isArray(t.data)&&t.data.forEach((a,s)=>{const h="object"==typeof a&&null!==a?a.value:a,l=this.grid.left+n+(e.length>1?s/(e.length-1)*o:0),g=this.grid.top+r-(h-c)/(d-c||1)*r;x.push({x:l,y:g,value:h,name:e[s]||s,seriesName:t.name||`Series ${i}`})}),h&&x.length>0&&this.drawFillArea(x,s,l,this.grid.top+r)}),t.forEach((t,i)=>{var a,s;if("line"!==t.type)return;const h=t.color||(null==(a=t.itemStyle)?void 0:a.color)||g.getColor(i),l=!1!==t.showSymbol,x=!0===t.smooth,u=(null==(s=t.lineStyle)?void 0:s.width)||2,p=[];t.data&&Array.isArray(t.data)&&t.data.forEach((a,s)=>{const h="object"==typeof a&&null!==a?a.value:a,l=this.grid.left+n+(e.length>1?s/(e.length-1)*o:0),g=this.grid.top+r-(h-c)/(d-c||1)*r;p.push({x:l,y:g,value:h,name:e[s]||s,seriesName:t.name||`Series ${i}`})}),this.seriesData.push({name:t.name||`Series ${i}`,points:p,color:h}),p.length>0&&(this.ctx.setLineWidth(u),this.ctx.setStrokeStyle(h),this.ctx.setLineJoin("round"),this.ctx.setLineCap("round"),x&&p.length>1?this.drawSmoothLine(p):this.drawStraightLine(p),this.ctx.stroke(),l&&(this.ctx.setFillStyle(h),p.forEach(t=>{this.ctx.beginPath(),this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.setFillStyle("#ffffff"),this.ctx.arc(t.x,t.y,2,0,2*Math.PI),this.ctx.fill(),this.ctx.setFillStyle(h)})))})},drawFillArea(t,e,i,a){if(t&&0!==t.length){if(this.ctx.beginPath(),this.ctx.moveTo(t[0].x,a),this.ctx.lineTo(t[0].x,t[0].y),i&&t.length>1)for(let e=0;e<t.length-1;e++){const i=0===e?t[0]:t[e-1],a=t[e],s=t[e+1],h=e===t.length-2?t[e+1]:t[e+2],n=a.x+(s.x-i.x)/6,o=a.y+(s.y-i.y)/6,r=s.x-(h.x-a.x)/6,l=s.y-(h.y-a.y)/6;this.ctx.bezierCurveTo(n,o,r,l,s.x,s.y)}else for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);if(this.ctx.lineTo(t[t.length-1].x,a),this.ctx.closePath(),"string"==typeof e&&e.startsWith("#")){const t=e.replace("#",""),i=parseInt(t.substring(0,2),16),a=parseInt(t.substring(2,4),16),s=parseInt(t.substring(4,6),16);this.ctx.setFillStyle(`rgba(${i}, ${a}, ${s}, 0.3)`)}else if("string"==typeof e&&e.startsWith("rgb")){const t=e.replace("rgb(","").replace(")","");this.ctx.setFillStyle(`rgba(${t}, 0.3)`)}else this.ctx.setFillStyle("rgba(84, 112, 198, 0.3)");this.ctx.fill()}},drawStraightLine(t){t&&0!==t.length&&(this.ctx.beginPath(),t.forEach((t,e)=>{0===e?this.ctx.moveTo(t.x,t.y):this.ctx.lineTo(t.x,t.y)}))},drawSmoothLine(t){if(t&&!(t.length<2)){if(this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),2===t.length){const e=(t[0].x+t[1].x)/2,i=(t[0].y+t[1].y)/2;return void this.ctx.quadraticCurveTo(e,i,t[1].x,t[1].y)}for(let e=0;e<t.length-1;e++){const i=0===e?t[0]:t[e-1],a=t[e],s=t[e+1],h=e===t.length-2?t[e+1]:t[e+2],n=a.x+(s.x-i.x)/6,o=a.y+(s.y-i.y)/6,r=s.x-(h.x-a.x)/6,l=s.y-(h.y-a.y)/6;this.ctx.bezierCurveTo(n,o,r,l,s.x,s.y)}}},handleTouchStart(t){if(t.touches&&t.touches.length>0){const e=t.touches[0];this.touchInfo.startX=e.x||0,this.touchInfo.startY=e.y||0}},handleTouchMove(t){t.preventDefault&&t.preventDefault()},handleTouchEnd(t){if(t.changedTouches&&t.changedTouches.length>0){const e=t.changedTouches[0],i=e.x||0,a=e.y||0,s=Math.abs(i-this.touchInfo.startX),h=Math.abs(a-this.touchInfo.startY);s<5&&h<5&&this.handleChartClick(i,a)}},handleChartClick(t,e){let i=1/0,a=null;this.seriesData&&this.seriesData.length>0&&this.seriesData.forEach(s=>{s.points&&s.points.length>0&&s.points.forEach(h=>{const n=Math.sqrt(Math.pow(h.x-t,2)+Math.pow(h.y-e,2));n<i&&n<20&&(i=n,a={seriesName:s.name,name:h.name,value:h.value,color:s.color,x:h.x,y:h.y})})}),a&&this.$emit("click",{componentType:"series",seriesType:"line",seriesName:a.seriesName,name:a.name,value:a.value,color:a.color,event:{offsetX:a.x,offsetY:a.y}})},setOption(t,e=!1){if(e)this.drawChart(t);else try{const e=JSON.parse(JSON.stringify(this.option));Object.assign(e,t),this.drawChart(e)}catch(i){console.error("合并配置失败:",i),this.drawChart(t)}},resize(){this.initCanvas()}}},[["render",function(t,r,l,c,d,g){const x=h,u=o;return i(),e(u,{class:"u-charts-line",style:n({width:g.containerWidth,height:g.containerHeight})},{default:a(()=>[s(x,{class:"chart-canvas",id:d.canvasId,"canvas-id":d.canvasId,onTouchstart:g.handleTouchStart,onTouchmove:g.handleTouchMove,onTouchend:g.handleTouchEnd},null,8,["id","canvas-id","onTouchstart","onTouchmove","onTouchend"])]),_:1},8,["style"])}],["__scopeId","data-v-95461928"]]);const u=t({data:()=>({straightOption:{title:{text:"直线折线图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["一月","二月","三月","四月","五月","六月"]},yAxis:{type:"value"},series:[{name:"销售额",type:"line",data:[120,132,101,134,90,230],smooth:!1,lineStyle:{width:2}}]},smoothOption:{title:{text:"平滑曲线折线图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{name:"访问量",type:"line",data:[120,200,150,80,70,110,130],smooth:!0,lineStyle:{width:3}}]},compareOption:{title:{text:"直线与曲线对比",textStyle:{fontSize:16}},legend:{bottom:0,data:["直线数据","曲线数据","曲线数据","曲线数据","曲线数据"]},xAxis:{type:"category",boundaryGap:!1,data:["1月","2月","3月","4月","5月","6月","7月","8月"]},yAxis:{type:"value"},series:[{name:"直线数据",type:"line",data:[120,132,101,134,90,230,210,150],smooth:!1,lineStyle:{width:2},areaStyle:{}},{name:"曲线数据",type:"line",data:[220,182,191,234,290,330,310,250],smooth:!0,lineStyle:{width:2},areaStyle:{}}]}}),methods:{onChartClick(){console.log("点击了图表")}}},[["render",function(t,h,n,g,u,p){const y=c,f=r(l("ly-charts-line"),x),m=o;return i(),e(m,{class:"u-page"},{default:a(()=>[s(m,{class:"u-page__item"},{default:a(()=>[s(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:a(()=>[d("直线")]),_:1}),s(m,{class:"u-page__item__content"},{default:a(()=>[s(f,{ref:"straightChart",option:u.straightOption,width:"700rpx",height:"260px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),s(m,{class:"u-page__item"},{default:a(()=>[s(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:a(()=>[d("平滑折线图")]),_:1}),s(m,{class:"u-page__item__content"},{default:a(()=>[s(f,{ref:"smoothOption",option:u.smoothOption,width:"700rpx",height:"260px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),s(m,{class:"u-page__item"},{default:a(()=>[s(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:a(()=>[d("对比图")]),_:1}),s(m,{class:"u-page__item__content"},{default:a(()=>[s(f,{ref:"compareOption",option:u.compareOption,width:"700rpx",height:"300px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-b8cd1b1f"]]);export{u as default};
