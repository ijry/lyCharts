import{_ as e,c as t,o as a,w as i,a as o,p as s,q as n,i as l,e as r,u as h,f as d,d as c,b as u}from"./index-BkcPNbdJ.js";import{c as g}from"./chartHelper.WSh08z7V.js";const m=e({name:"up-charts-gauge",props:{width:{type:[String,Number],default:300},height:{type:[String,Number],default:300},option:{type:Object,default:()=>({})}},data:()=>({canvasId:"chart-gauge"+Date.now(),canvasWidth:300,canvasHeight:300,progressValue:[],animationTimer:null,targetValue:0,isInited:!1}),watch:{option:{handler(e){console.log(e),this.updateChart(e)},deep:!0}},mounted(){this.init()},methods:{init(){this.canvasWidth=Number(this.width),this.canvasHeight=Number(this.height),setTimeout(()=>{this.updateChart(this.option)},100)},drawChart(){const e=uni.createCanvasContext(this.canvasId,this);this.drawGauge(e)},angleToRadBase(e){if(e>=0){return(2-e/360*2)*Math.PI}return Math.abs(e/360*2)*Math.PI},drawGauge(e){const{width:t,height:a}=this,i=t/2,o=a/2,s=this.option.series&&this.option.series.length>0?this.option.series[0]:{},n=s.data&&s.data.length>0?s.data:[{value:0}],l=n.map((e,t)=>this.isInited&&void 0!==this.progressValue[t]?this.progressValue[t]:e.value||0),r=s.progress||{show:!1,width:12},h=s.itemStyle||{},d=s.axisLine||{lineStyle:{width:12}},c=s.axisTick||{show:!0},u=s.splitLine||{length:10,lineStyle:{width:2,color:"#999"}},m=s.axisLabel||{distance:10,color:"#999",fontSize:12},f=s.anchor||{show:!1,size:1,itemStyle:{borderWidth:1}},p=s.detail||{show:!0,fontSize:20,offsetCenter:[0,0]},w=void 0!==s.startAngle?s.startAngle:225,S=void 0!==s.endAngle?s.endAngle:-45,y=void 0!==s.min?s.min:0,v=void 0!==s.max?s.max:100,C=void 0!==u.splitNumber?u.splitNumber:10,T=void 0!==c.splitNumber?c.splitNumber:5;let b=this.angleToRadBase(w),M=this.angleToRadBase(S),x=S-w;x<0&&(x=Math.abs(x));let A=Math.min(t,a)/2*.8,L=d.lineStyle.width||12,_=r.width||L;e.clearRect(0,0,t,a),e.beginPath(),e.arc(i,o,A,b,M,!1);const z=d.lineStyle.color;if(Array.isArray(z)&&z.length>0)for(let g=0;g<z.length;g++){const[t,a]=z[g],s=0===g?0:z[g-1][0],n=this.angleToRadBase(w-s*x),l=this.angleToRadBase(w-t*x);e.beginPath(),e.arc(i,o,A,n,l,!1),e.setStrokeStyle(a),e.setLineWidth(L),e.setLineCap("butt"),e.stroke()}else e.setStrokeStyle(z||"#E6EBF8"),e.setLineWidth(L),e.setLineCap("butt"),e.stroke();if(!1!==r.show){const t=1;let a=A;n.forEach((s,n)=>{const r=l[n];l.length>1&&(_=(L-(l.length+1)*t)/l.length);const d=(r-y)/(v-y),c=Math.max(0,Math.min(1,d)),u=this.angleToRadBase(w-c*x);l.length>1?(0==n&&(a=A+(l.length/2+.5)*_+t*(l.length/2).toFixed(0)),a=a-_-t):a=A-n*(_+t),e.beginPath(),e.arc(i,o,a,b,u);const m=s.itemStyle||{};let f="";f=m.color?m.color:h.color?h.color:g.getColor(n),e.setStrokeStyle(f),h.shadowColor&&e.setShadow(h.shadowOffsetX||0,h.shadowOffsetY||0,h.shadowBlur||0,h.shadowColor),e.setLineWidth(_),e.setLineCap("round"),e.stroke(),h.shadowColor&&e.setShadow(0,0,0,"rgba(0,0,0,0)")})}if(!1!==c.show)for(let g=0;g<=C;g++)if(g<C)for(let t=1;t<=T;t++){const a=this.angleToRadBase(w-(g+t/(T+1))/C*x),s=c.distance||10,n=A-5-s,l=A-s,r=i+n*Math.cos(a),h=o+n*Math.sin(a),d=i+l*Math.cos(a),u=o+l*Math.sin(a);e.beginPath(),e.moveTo(r,h),e.lineTo(d,u),e.setStrokeStyle(c.lineStyle?c.lineStyle.color:"#999"),e.setLineWidth(c.lineStyle?c.lineStyle.width:1),e.stroke()}if(!1!==u.show)for(let g=0;g<=C;g++){const t=this.angleToRadBase(w-g/C*x),a=u.distance||10,s=A-u.length-a,n=A-a,l=i+s*Math.cos(t),r=o+s*Math.sin(t),h=i+n*Math.cos(t),d=o+n*Math.sin(t);if(e.beginPath(),e.moveTo(l,r),e.lineTo(h,d),e.setStrokeStyle(u.lineStyle?u.lineStyle.color:"#999"),e.setLineWidth(u.lineStyle?u.lineStyle.width:2),e.stroke(),!1!==m.show){const s=m.distance||10,n=A-u.length-a-s,l=i+n*Math.cos(t),r=o+n*Math.sin(t);e.setFontSize(m.fontSize||12),e.setFillStyle(m.color||"#999"),e.setTextAlign("center"),e.setTextBaseline("middle");const h=y+g/C*(v-y);e.fillText(h.toString(),l,r)}}const I=s.pointer||{};if(n.length>0&&!1!==I.show&&n.forEach((t,a)=>{const s=l[a],n=t.itemStyle||{},r=(s-y)/(v-y),h=Math.max(0,Math.min(1,r)),d=this.angleToRadBase(w-h*x),c=void 0!==I.length?I.length:A;let u=void 0!==I.width?I.width:6;u-=1.5*a;const m=.7*c,f=i+m*Math.cos(d),p=o+m*Math.sin(d),S=i,C=o,T=d+Math.PI/2,b=u/2,M=i+b*Math.cos(T),L=o+b*Math.sin(T),_=i-b*Math.cos(T),z=o-b*Math.sin(T),F=1.5*u/2,k=i+F*Math.cos(T),P=o+F*Math.sin(T),B=i-F*Math.cos(T),O=o-F*Math.sin(T);e.beginPath(),e.moveTo(f,p),e.lineTo(M,L),e.lineTo(_,z),e.closePath();const D=n.color||g.getColor(a);e.setFillStyle(D),n.shadowColor&&e.setShadow(n.shadowOffsetX||0,n.shadowOffsetY||0,n.shadowBlur||0,n.shadowColor),e.fill(),e.beginPath(),e.moveTo(S,C),e.lineTo(k,P),e.lineTo(B,O),e.closePath(),e.setFillStyle(D),e.fill(),n.shadowColor&&e.setShadow(0,0,0,"rgba(0,0,0,0)")}),!1!==f.show&&(e.beginPath(),e.arc(i,o,f.size||5,0,2*Math.PI),e.setFillStyle(f.itemStyle&&f.itemStyle.color||"#fff"),e.fill(),e.beginPath(),e.arc(i,o,(f.size||5)+(f.itemStyle.borderWidth||2),0,2*Math.PI),e.setFillStyle(f.itemStyle&&f.itemStyle.borderColor||"#333"),e.fill()),!1!==p.show&&n.length>0){const t=n[0],a=l[0],s=t.name||"";let r=a.toString();p.formatter&&(r=p.formatter.replace("{value}",Math.round(a)));const h=p.offsetCenter&&Array.isArray(p.offsetCenter)&&p.offsetCenter.length>0?p.offsetCenter[0]:0,d=p.offsetCenter&&Array.isArray(p.offsetCenter)&&p.offsetCenter.length>1?p.offsetCenter[1]:0;let c=.6,u=o+50+d;if(s){e.setFontSize((p.fontSize||30)*c),e.setFillStyle(p.color||"#333"),e.setTextAlign("center"),e.setTextBaseline("middle"),e.fillText(s,i+h,o+30+d);const t=(e.measureText?e.measureText(s):{width:s.length*((p.fontSize||30)*c)*.6}).width>0?(p.fontSize||30)*c:0;u=o+30+d+1.7*t}e.setFontSize(p.fontSize||30),e.setFillStyle(p.color||"#333"),e.setTextAlign("center"),e.setTextBaseline("middle"),e.fillText(r,i+h,u)}e.draw()},startAnimation(e,t=1e3){this.animationTimer&&clearInterval(this.animationTimer);const a=Date.now(),i=this.progressValue,o=e-i;this.animationTimer=setInterval(()=>{const e=Date.now()-a,s=Math.min(e/t,1),n=1-Math.pow(1-s,4);this.progressValue=i+o*n,this.drawChart(),s>=1&&(clearInterval(this.animationTimer),this.animationTimer=null)},16)},updateChart(e){const t=e.series&&e.series.length>0?e.series[0]:{},a=(t.data&&t.data.length>0?t.data:[{value:0}]).map(e=>e.value||0),i=t.detail||{};if(this.isInited=!0,i.valueAnimation){const i=Date.now(),o=void 0!==e.animationDuration?e.animationDuration:1e3,s=void 0!==t.animationDuration?t.animationDuration:o,n=this.progressValue.length>0?this.progressValue:new Array(a.length).fill(0),l=a,r=()=>{const e=Date.now()-i,t=Math.min(e/s,1),a=1-Math.pow(1-t,4);this.progressValue=n.map((e,t)=>(e+((l[t]||0)-e)*a).toFixed(0)),this.drawChart(),t<1&&requestAnimationFrame(r)};requestAnimationFrame(r)}else this.progressValue=[...a],this.drawChart()},tap(e){this.$emit("click",e)},getChartInstance:()=>null,refresh(){this.drawChart()}},beforeDestroy(){this.animationTimer&&clearInterval(this.animationTimer)}},[["render",function(e,r,h,d,c,u){const g=s,m=l;return a(),t(m,{class:"up-charts-gauge"},{default:i(()=>[o(g,{id:c.canvasId,"canvas-id":c.canvasId,style:n({width:c.canvasWidth+"px",height:c.canvasHeight+"px"}),onClick:u.tap},null,8,["id","canvas-id","style","onClick"])]),_:1})}],["__scopeId","data-v-61ec0645"]]);const f=e({data:()=>({gaugeOption1:{pointer:{length:"75%",width:16},series:[{type:"gauge",startAngle:225,endAngle:-45,data:[{value:60,name:"速度"}]}]},gaugeOption2:{series:[{type:"gauge",min:0,max:240,progress:{show:!0,color:"red"},detail:{valueAnimation:!1},animationDuration:1e3,axisLine:{lineStyle:{width:12,color:[[1,"#eee"]]}},data:[{value:60,name:"功率"}]}]},gaugeOption3:{series:[{type:"gauge",progress:{show:!0,width:12},axisLine:{lineStyle:{width:12,color:[[.3,"#67C23A"],[.7,"#E6A23C"],[1,"#F56C6C"]]}},splitLine:{splitNumber:5,length:15,lineStyle:{width:3,color:"#999"}},axisLabel:{distance:25,color:"#666",fontSize:14},anchor:{show:!0,size:10,itemStyle:{borderWidth:1,borderColor:"#5572CA"}},detail:{show:!0,fontSize:24,color:"#333",formatter:"{value}%"},data:[{value:20,name:"完成度"}]}]},gaugeOption4:{series:[{type:"gauge",progress:{show:!0,width:1},axisLine:{splitNumber:3,lineStyle:{width:12,color:[[1,"#f1f1f1"]]}},splitLine:{length:10,lineStyle:{width:2,color:"#999"}},axisLabel:{distance:15,color:"#666",fontSize:12},itemStyle:{color:"green"},anchor:{show:!0,size:8,itemStyle:{borderWidth:1,borderColor:"#5572CA"}},detail:{valueAnimation:!0,show:!0,fontSize:25,color:"#409EFF",formatter:"{value}km/h",offsetCenter:[0,0]},data:[{value:65,name:"时速"}]}]},gaugeOption5:{series:[{type:"gauge",min:0,max:130,progress:{show:!0},startAngle:270,endAngle:-89,pointer:{show:!1},detail:{valueAnimation:!0},axisTick:{show:!1},splitLine:{show:!1},animationDuration:3e3,progress:{show:!0,width:38},axisLine:{lineStyle:{width:40,color:[[1,"#f7f7f7"]]}},data:[{value:60,name:"功率"},{value:120,name:"功率2"},{value:90,name:"功率3"},{value:80,name:"功率4"}]}]}}),mounted(){},methods:{}},[["render",function(e,s,n,g,f,p){const w=l,S=r(d("u-toast"),h),y=u,v=r(d("ly-charts-gauge"),m);return a(),t(w,{class:"u-demo"},{default:i(()=>[o(w,{class:"u-demo-wrap"},{default:i(()=>[o(w,{class:"u-demo-title"},{default:i(()=>[c("演示")]),_:1}),o(w,{class:"u-demo-area"},{default:i(()=>[o(S,{ref:"uToast"},null,512),o(w,{class:"u-demo-item"},{default:i(()=>[o(y,{class:"u-demo-title"},{default:i(()=>[c("基础仪表盘")]),_:1}),o(v,{width:300,height:300,option:f.gaugeOption1},null,8,["option"])]),_:1}),o(w,{class:"u-demo-item"},{default:i(()=>[o(y,{class:"u-demo-title"},{default:i(()=>[c("带进度条的仪表盘")]),_:1}),o(v,{width:300,height:300,option:f.gaugeOption2},null,8,["option"])]),_:1}),o(w,{class:"u-demo-item"},{default:i(()=>[o(y,{class:"u-demo-title"},{default:i(()=>[c("自定义样式的仪表盘")]),_:1}),o(v,{width:300,height:300,option:f.gaugeOption3},null,8,["option"])]),_:1}),o(w,{class:"u-demo-item"},{default:i(()=>[o(y,{class:"u-demo-title"},{default:i(()=>[c("带动画效果的仪表盘")]),_:1}),o(v,{width:300,height:300,option:f.gaugeOption4},null,8,["option"])]),_:1}),o(w,{class:"u-demo-item"},{default:i(()=>[o(y,{class:"u-demo-title"},{default:i(()=>[c("多进度圆环仪表盘")]),_:1}),o(v,{width:260,height:260,option:f.gaugeOption5},null,8,["option"])]),_:1})]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-89462382"]]);export{f as default};
