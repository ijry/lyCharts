import{_ as t,c as e,o as i,w as s,a,p as h,q as o,i as n,e as l,f as r,b as c,d}from"./index-BTlcQG3k.js";import{c as x}from"./chartHelper.C9kNWy3w.js";const g=t({name:"u-charts-line",props:{option:{type:Object,default:()=>({})},height:{type:[String,Number],default:400},width:{type:[String,Number],default:"100%"}},data:()=>({canvasId:"line-chart-"+Date.now(),ctx:null,canvasWidth:0,canvasHeight:0,grid:{top:10,right:20,bottom:25,left:50},seriesData:[],touchInfo:{startX:0,startY:0}}),computed:{containerHeight(){return"number"==typeof this.height?this.height+"px":this.height},containerWidth(){return"number"==typeof this.width?this.width+"px":this.width}},watch:{option:{handler(t){this.drawChart(t)},deep:!0}},mounted(){this.$nextTick(()=>{this.initCanvas()})},methods:{initCanvas(){try{uni.createSelectorQuery().in(this).select("#"+this.canvasId).boundingClientRect(t=>{if(t){if(this.canvasWidth=t.width,this.canvasHeight=t.height,this.ctx=uni.createCanvasContext(this.canvasId,this),!this.ctx)return void console.error("无法获取canvas绘图上下文");this.drawChart(this.option)}else console.error("无法获取canvas信息")}).exec()}catch(t){console.error("初始化canvas失败:",t)}},drawChart(t){if(this.ctx&&t)try{this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.backgroundColor&&(this.ctx.setFillStyle(t.backgroundColor),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight));let e=0;t.title&&t.title.text&&(e=x.drawTitle(this.ctx,t.title,this.canvasWidth)),e>0&&(this.grid.top=Math.max(this.grid.top,e+10));const i=t.series||[],s=t.xAxis||{},a=t.yAxis||{},h=x.processXAxisData(s,i),{minY:o,maxY:n}=x.calculateDataRange(i),l=t.xAxisPadding||0;let r=0;if(t.legend&&t.legend.data){const i={...t.legend};r=x.drawLegend(this.ctx,i,this.grid,this.canvasWidth,x.defaultColors,this.canvasHeight,e)}const c=!1;!1!==t.grid&&x.drawGrid(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,h.length,o,n,c,l),x.drawAxis(this.ctx,this.grid,this.canvasWidth,this.canvasHeight,h,o,n,s,a,"line",l),this.drawSeries(i,h,o,n,x.adjustedYMin,x.adjustedYMax,l),this.ctx.draw()}catch(e){console.error("绘制图表失败:",e)}},drawSeries(t,e,i,s,a,h,o=0){if(!t||0===t.length)return;const n=this.canvasWidth-this.grid.left-this.grid.right-2*o,l=this.canvasHeight-this.grid.top-this.grid.bottom;this.seriesData=[];const r=void 0!==a&&void 0!==h,c=r?a:i,d=r?h:s;t.forEach((t,i)=>{var s;if("line"!==t.type)return;const a=t.color||(null==(s=t.itemStyle)?void 0:s.color)||x.getColor(i),h=(null==t?void 0:t.areaStyle)||t.fillArea,r=!0===t.smooth,g=[];t.data&&Array.isArray(t.data)&&t.data.forEach((s,a)=>{const h="object"==typeof s&&null!==s?s.value:s,r=this.grid.left+o+(e.length>1?a/(e.length-1)*n:0),x=this.grid.top+l-(h-c)/(d-c||1)*l;g.push({x:r,y:x,value:h,name:e[a]||a,seriesName:t.name||`Series ${i}`})}),h&&g.length>0&&this.drawFillArea(g,a,r,this.grid.top+l)}),t.forEach((t,i)=>{var s,a;if("line"!==t.type)return;const h=t.color||(null==(s=t.itemStyle)?void 0:s.color)||x.getColor(i),r=!1!==t.showSymbol,g=!0===t.smooth,u=(null==(a=t.lineStyle)?void 0:a.width)||2,p=t.label||{},y=!0===p.show,f=p.color||"#666",m=p.position||"top",v=[];t.data&&Array.isArray(t.data)&&t.data.forEach((s,a)=>{const h="object"==typeof s&&null!==s?s.value:s,r=this.grid.left+o+(e.length>1?a/(e.length-1)*n:0),x=this.grid.top+l-(h-c)/(d-c||1)*l;v.push({x:r,y:x,value:h,name:e[a]||a,seriesName:t.name||`Series ${i}`})}),this.seriesData.push({name:t.name||`Series ${i}`,points:v,color:h}),v.length>0&&(this.ctx.setLineWidth(u),this.ctx.setStrokeStyle(h),this.ctx.setLineJoin("round"),this.ctx.setLineCap("round"),g&&v.length>1?this.drawSmoothLine(v):this.drawStraightLine(v),this.ctx.stroke(),r&&(this.ctx.setFillStyle(h),v.forEach(t=>{this.ctx.beginPath(),this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.setFillStyle("#ffffff"),this.ctx.arc(t.x,t.y,2,0,2*Math.PI),this.ctx.fill(),this.ctx.setFillStyle(h)})),y&&this.drawLabels(v,f,m))})},drawFillArea(t,e,i,s){if(t&&0!==t.length){if(this.ctx.beginPath(),this.ctx.moveTo(t[0].x,s),this.ctx.lineTo(t[0].x,t[0].y),i&&t.length>1)for(let e=0;e<t.length-1;e++){const i=0===e?t[0]:t[e-1],s=t[e],a=t[e+1],h=e===t.length-2?t[e+1]:t[e+2],o=s.x+(a.x-i.x)/6,n=s.y+(a.y-i.y)/6,l=a.x-(h.x-s.x)/6,r=a.y-(h.y-s.y)/6;this.ctx.bezierCurveTo(o,n,l,r,a.x,a.y)}else for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);if(this.ctx.lineTo(t[t.length-1].x,s),this.ctx.closePath(),"string"==typeof e&&e.startsWith("#")){const t=e.replace("#",""),i=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16);this.ctx.setFillStyle(`rgba(${i}, ${s}, ${a}, 0.3)`)}else if("string"==typeof e&&e.startsWith("rgb")){const t=e.replace("rgb(","").replace(")","");this.ctx.setFillStyle(`rgba(${t}, 0.3)`)}else this.ctx.setFillStyle("rgba(84, 112, 198, 0.3)");this.ctx.fill()}},drawStraightLine(t){t&&0!==t.length&&(this.ctx.beginPath(),t.forEach((t,e)=>{0===e?this.ctx.moveTo(t.x,t.y):this.ctx.lineTo(t.x,t.y)}))},drawSmoothLine(t){if(t&&!(t.length<2)){if(this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),2===t.length){const e=(t[0].x+t[1].x)/2,i=(t[0].y+t[1].y)/2;return void this.ctx.quadraticCurveTo(e,i,t[1].x,t[1].y)}for(let e=0;e<t.length-1;e++){const i=0===e?t[0]:t[e-1],s=t[e],a=t[e+1],h=e===t.length-2?t[e+1]:t[e+2],o=s.x+(a.x-i.x)/6,n=s.y+(a.y-i.y)/6,l=a.x-(h.x-s.x)/6,r=a.y-(h.y-s.y)/6;this.ctx.bezierCurveTo(o,n,l,r,a.x,a.y)}}},drawLabels(t,e,i){t&&0!==t.length&&t.forEach(t=>{const s=t.value.toString();this.ctx.setFontSize(10),this.ctx.setFillStyle(e),this.ctx.setTextAlign("center"),this.ctx.setTextBaseline("bottom");let a=t.x,h=t.y;switch(i){case"top":h-=6;break;case"bottom":h+=6,this.ctx.setTextBaseline("top");break;case"left":a-=6,this.ctx.setTextAlign("right"),this.ctx.setTextBaseline("middle");break;case"right":a+=6,this.ctx.setTextAlign("left"),this.ctx.setTextBaseline("middle");break;default:h-=10}this.ctx.fillText(s,a,h)})},handleTouchStart(t){if(t.touches&&t.touches.length>0){const e=t.touches[0];this.touchInfo.startX=e.x||0,this.touchInfo.startY=e.y||0}},handleTouchMove(t){t.preventDefault&&t.preventDefault()},handleTouchEnd(t){if(t.changedTouches&&t.changedTouches.length>0){const e=t.changedTouches[0],i=e.x||0,s=e.y||0,a=Math.abs(i-this.touchInfo.startX),h=Math.abs(s-this.touchInfo.startY);a<5&&h<5&&this.handleChartClick(i,s)}},handleChartClick(t,e){let i=1/0,s=null;this.seriesData&&this.seriesData.length>0&&this.seriesData.forEach(a=>{a.points&&a.points.length>0&&a.points.forEach(h=>{const o=Math.sqrt(Math.pow(h.x-t,2)+Math.pow(h.y-e,2));o<i&&o<20&&(i=o,s={seriesName:a.name,name:h.name,value:h.value,color:a.color,x:h.x,y:h.y})})}),s&&this.$emit("click",{componentType:"series",seriesType:"line",seriesName:s.seriesName,name:s.name,value:s.value,color:s.color,event:{offsetX:s.x,offsetY:s.y}})},setOption(t,e=!1){if(e)this.drawChart(t);else try{const e=JSON.parse(JSON.stringify(this.option));Object.assign(e,t),this.drawChart(e)}catch(i){console.error("合并配置失败:",i),this.drawChart(t)}},resize(){this.initCanvas()}}},[["render",function(t,l,r,c,d,x){const g=h,u=n;return i(),e(u,{class:"u-charts-line",style:o({width:x.containerWidth,height:x.containerHeight})},{default:s(()=>[a(g,{class:"chart-canvas",id:d.canvasId,"canvas-id":d.canvasId,onTouchstart:x.handleTouchStart,onTouchmove:x.handleTouchMove,onTouchend:x.handleTouchEnd},null,8,["id","canvas-id","onTouchstart","onTouchmove","onTouchend"])]),_:1},8,["style"])}],["__scopeId","data-v-93b9e19f"]]);const u=t({data:()=>({straightOption:{title:{text:"直线折线图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["一月","二月","三月","四月","五月","六月"]},yAxis:{type:"value",axisLabel:{show:!1}},series:[{name:"销售额",type:"line",data:[120,132,101,134,90,230],smooth:!1,lineStyle:{width:2},label:{show:!0,color:"#666",position:"top"}}]},smoothOption:{title:{text:"平滑曲线折线图",textStyle:{fontSize:16,color:"#333"}},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value",axisLabel:{show:!0}},series:[{name:"访问量",type:"line",data:[120,200,150,80,70,110,130],smooth:!0,lineStyle:{width:3}}]},compareOption:{title:{text:"直线与曲线对比",textStyle:{fontSize:16}},legend:{bottom:0,data:["直线数据","曲线数据","曲线数据","曲线数据","曲线数据"]},xAxis:{type:"category",boundaryGap:!1,data:["1月","2月","3月","4月","5月","6月","7月","8月"]},yAxis:{type:"value",axisLabel:{show:!1}},series:[{name:"直线数据",type:"line",data:[120,132,101,134,90,230,210,150],smooth:!1,lineStyle:{width:2},areaStyle:{}},{name:"曲线数据",type:"line",data:[220,182,191,234,290,330,310,250],smooth:!0,lineStyle:{width:2},areaStyle:{}}]}}),methods:{onChartClick(){console.log("点击了图表")}}},[["render",function(t,h,o,x,u,p){const y=c,f=l(r("ly-charts-line"),g),m=n;return i(),e(m,{class:"u-page"},{default:s(()=>[a(m,{class:"u-page__item"},{default:s(()=>[a(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("直线")]),_:1}),a(m,{class:"u-page__item__content"},{default:s(()=>[a(f,{ref:"straightChart",option:u.straightOption,width:"700rpx",height:"200px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),a(m,{class:"u-page__item"},{default:s(()=>[a(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("平滑折线图")]),_:1}),a(m,{class:"u-page__item__content"},{default:s(()=>[a(f,{ref:"smoothOption",option:u.smoothOption,width:"700rpx",height:"200px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1}),a(m,{class:"u-page__item"},{default:s(()=>[a(y,{class:"u-page__item__title",style:{"margin-top":"0"}},{default:s(()=>[d("对比图")]),_:1}),a(m,{class:"u-page__item__content"},{default:s(()=>[a(f,{ref:"compareOption",option:u.compareOption,width:"700rpx",height:"260px",onClick:p.onChartClick},null,8,["option","onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-cde4dd33"]]);export{u as default};
