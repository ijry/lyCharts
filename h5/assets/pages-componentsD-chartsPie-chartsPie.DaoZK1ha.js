import{_ as t,c as e,o as i,w as s,s as a,a as n,i as h,q as o,b as l,d as r,t as d,p as c,e as p,f as u}from"./index-CX9O2B3o.js";const f=t({name:"u-charts-pie",props:{options:{type:Object,default:()=>({})},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:300}},data(){return{cid:"u-charts-pie-"+Math.random().toString(36).substr(2),canvasWidth:"string"==typeof this.width&&-1!==this.width.indexOf("%")?null:"number"==typeof this.width?this.width:this.parseUnit(this.width),canvasHeight:"string"==typeof this.height?this.parseUnit(this.height):this.height,chartInstance:null,isMount:!1}},watch:{options:{handler(t){this.isMount&&this.drawChart()},deep:!0}},mounted(){this.isMount=!0,this.$nextTick(()=>{this.init()})},beforeDestroy(){this.chartInstance&&this.chartInstance.destroy()},methods:{init(){this.getCanvasSize().then(()=>{this.drawChart()})},initNvue(){dom.getComponentRect(this.$refs.canvas,t=>{t.result&&(this.canvasWidth=t.size.width,this.canvasHeight=t.size.height,this.drawChart())})},parseUnit:t=>"number"==typeof t?t:"string"==typeof t?t.endsWith("rpx")?uni.upx2px(parseInt(t)):t.endsWith("px")?parseInt(t):t.endsWith("%")?t:parseInt(t)||0:0,getCanvasSize(){return new Promise(t=>{"number"==typeof this.canvasWidth&&this.canvasWidth>0?t():uni.createSelectorQuery().in(this).select("#"+this.cid).boundingClientRect(e=>{e?(this.canvasWidth=e.width||this.width,this.canvasHeight=e.height||this.height):(this.canvasWidth="string"==typeof this.width&&-1!==this.width.indexOf("%")?uni.upx2px(750)*parseInt(this.width)/100:this.parseUnit(this.width),this.canvasHeight=this.parseUnit(this.height)),t()}).exec()})},drawChart(){this.options&&Object.keys(this.options).length&&this.drawNativePie()},drawNativePie(){var t,e,i,s,a;const n=uni.createCanvasContext(this.cid,this);n.clearRect(0,0,this.canvasWidth,this.canvasHeight);const h=this.options.series&&this.options.series[0]||{},o=h.data||[];if(!o.length)return;const l=o.reduce((t,e)=>t+e.value,0);let r=this.canvasWidth/2,d=this.canvasHeight/2,c=0,p=0,u=0,f=0;if(this.options.legend&&!1!==this.options.legend.show){const t=80,e=20;let i=this.options.legend;const s=i.top,a=i.bottom,n=i.left,h=i.right,l=void 0!==s&&"auto"!==s,g=void 0!==a&&"auto"!==a,v=void 0!==n&&"auto"!==n,y=void 0!==h&&"auto"!==h,m=!l&&!g;"vertical"===this.options.legend.orient?(o.length,v?(c=t,r=(this.canvasWidth+c)/2):y&&(p=t,r=(this.canvasWidth-p)/2)):(o.length,l?("number"==typeof s||"string"==typeof s&&s.endsWith("%")&&(parseInt(s),this.canvasHeight),u=2*e,d=(this.canvasHeight+u)/2):(g||m)&&("number"==typeof a||"string"==typeof a&&a.endsWith("%")&&(parseInt(a),this.canvasHeight),f=2*e,d=(this.canvasHeight-f)/2))}let g,v,y=h.radius||"65%";Array.isArray(y)?(g=y[0],v=y[1]):(g=0,v=y),"string"==typeof v&&v.endsWith("%")?v=parseFloat(v)/100:"number"==typeof v&&(v/=Math.min(this.canvasWidth,this.canvasHeight)),"string"==typeof g&&g.endsWith("%")?g=parseFloat(g)/100:"number"==typeof g&&(g/=Math.min(this.canvasWidth,this.canvasHeight));const m=this.canvasWidth-c-p-20,b=this.canvasHeight-u-f-20,W=Math.min(m,b)*("number"==typeof v?v:.7)/2,I=W*(g||0),w=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"];let x=-Math.PI/2;const S=[];for(let _=0;_<o.length;_++){const c=o[_],p=c.value/l,u=x+2*p*Math.PI;if(S.push({startAngle:x,endAngle:u,middleAngle:(x+u)/2,percent:p,data:c}),n.beginPath(),I>0?(n.arc(r,d,W,x,u),n.arc(r,d,I,u,x,!0)):(n.moveTo(r,d),n.arc(r,d,W,x,u),n.closePath()),n.setFillStyle(c.color||(null==(t=c.itemStyle)?void 0:t.color)||w[_%w.length]),n.fill(),(null==(e=h.itemStyle)?void 0:e.borderWidth)||(null==(i=c.itemStyle)?void 0:i.borderWidth)){const t=void 0!==(null==(s=c.itemStyle)?void 0:s.borderWidth)?c.itemStyle.borderWidth:h.itemStyle.borderWidth,e=(null==(a=c.itemStyle)?void 0:a.borderColor)||h.itemStyle.borderColor||"#ffffff";n.setLineWidth(t),n.setStrokeStyle(e),n.stroke()}else n.setStrokeStyle("#ffffff"),n.setLineWidth(2),n.stroke();x=u}this.drawLabelsWithLines(n,S,r,d,W,w,o),this.options.legend&&!1!==this.options.legend.show&&this.drawLegend(n,o,w),n.draw(!1),this.chartInstance={type:"native-pie",data:o,centerX:r,centerY:d,radius:W,innerRadius:I,total:l,sectorAngles:S,destroy:()=>{}}},drawLabelsWithLines(t,e,i,s,a,n,h){const o=a+30,l=a+15;t.setFontSize(12),t.setTextBaseline("middle");for(let r=0;r<e.length;r++){const n=e[r],h=n.data,d=n.middleAngle,c=i+a*Math.cos(d),p=s+a*Math.sin(d),u=i+l*Math.cos(d),f=s+l*Math.sin(d),g=i+o*Math.cos(d),v=s+o*Math.sin(d);let y=g;const m=20;y=Math.abs(d)<Math.PI/2?g+m:g-m,t.beginPath(),t.moveTo(c,p),t.lineTo(u,f),t.lineTo(y,v),t.setStrokeStyle("#666666"),t.setLineWidth(1),t.stroke();const b=h.name;t.setFontSize(12);const W=t.measureText(b).width;Math.abs(d)<Math.PI/2?(t.setFillStyle("#ffffff"),t.fillRect(y,v-10,W+10,20),t.setFillStyle("#333333"),t.setTextAlign("left"),t.fillText(b,y+5,v)):(t.setFillStyle("#ffffff"),t.fillRect(y-W-10,v-10,W+10,20),t.setFillStyle("#333333"),t.setTextAlign("right"),t.fillText(b,y-5,v))}},drawLegend(t,e,i){const s=this.options.legend;if(!s||!1===s.show)return;let a,n;const h=s.top,o=s.bottom,l=s.left,r=s.right,d=void 0!==h&&"auto"!==h,c=void 0!==o&&"auto"!==o,p=void 0!==l&&"auto"!==l,u=void 0!==r&&"auto"!==r,f=!d&&!c;if("vertical"===s.orient){const t=80,i=24*e.length;if(p)a="number"==typeof l?l:"string"==typeof l&&l.endsWith("%")?parseInt(l)/100*this.canvasWidth:10;else if(u){let e=10;"number"==typeof r?e=r:"string"==typeof r&&r.endsWith("%")&&(e=parseInt(r)/100*this.canvasWidth),a=this.canvasWidth-t-e}else a=this.canvasWidth/2-t/2;if(d)n="number"==typeof h?h:"string"==typeof h&&h.endsWith("%")?parseInt(h)/100*this.canvasHeight:10;else if(c||f){let t=10;"number"==typeof o?t=o:"string"==typeof o&&o.endsWith("%")?t=parseInt(o)/100*this.canvasHeight:f&&(t=10),n=this.canvasHeight-i-t}else n=this.canvasHeight/2-i/2}else{const t=70*e.length,i=14;if(p)a="number"==typeof l?l:"string"==typeof l&&l.endsWith("%")?parseInt(l)/100*this.canvasWidth:10;else if(u){let e=10;"number"==typeof r?e=r:"string"==typeof r&&r.endsWith("%")&&(e=parseInt(r)/100*this.canvasWidth),a=this.canvasWidth-t-e}else a=this.canvasWidth/2-t/2;if(d)n="number"==typeof h?h:"string"==typeof h&&h.endsWith("%")?parseInt(h)/100*this.canvasHeight:10;else if(c||f){let t=10;"number"==typeof o?t=o:"string"==typeof o&&o.endsWith("%")?t=parseInt(o)/100*this.canvasHeight:f&&(t=10),n=this.canvasHeight-i-t}else n=10}t.setFontSize(12),t.setTextBaseline("middle");for(let g=0;g<e.length;g++){const h=e[g];let o,l;"vertical"===s.orient?(o=a,l=n+24*g):(o=a+70*g,l=n),t.setFillStyle(h.color||i[g%i.length]),t.fillRect(o,l-6,12,12),t.setFillStyle("#333"),t.setTextAlign("left"),t.fillText(h.name,o+18,l)}},tap(t){if(this.chartInstance&&"native-pie"===this.chartInstance.type){const{x:e,y:i}=t.touches[0],s=e-this.chartInstance.centerX,a=i-this.chartInstance.centerY;if(Math.sqrt(s*s+a*a)<=this.chartInstance.radius){const e=(Math.atan2(a,s)+Math.PI/2+2*Math.PI)%(2*Math.PI);let i=0,n=-1;for(let t=0;t<this.chartInstance.data.length;t++){if(i+=this.chartInstance.data[t].value/this.chartInstance.total*2*Math.PI,e<=i){n=t;break}}if(-1!==n){const e=this.chartInstance.data[n];this.$emit("click",{name:e.name,value:e.value,dataIndex:n,data:e,event:t}),this.options.tooltip&&"item"===this.options.tooltip.trigger&&this.$emit("tooltipShow",{name:e.name,value:e.value,dataIndex:n,data:e})}}}},move(t){},touchEnd(t){},updateData(t){this.chartInstance&&"native-pie"===this.chartInstance.type&&(this.options.series[0].data=t,this.drawNativePie())},getChartInstance(){return this.chartInstance}}},[["render",function(t,p,u,f,g,v){const y=l,m=h,b=c;return i(),e(m,{class:"u-charts-pie",style:o({width:u.width})},{default:s(()=>[u.options.title&&!1!==u.options.title.show?(i(),e(m,{key:0,class:"chart-title",style:o({textAlign:"center"===u.options.title.left?"center":"right"===u.options.title.left?"right":"left"})},{default:s(()=>{var t,h,l,c;return[n(y,{class:"main-title",style:o({color:(null==(t=u.options.title.textStyle)?void 0:t.color)||"#333",fontSize:(null==(h=u.options.title.textStyle)?void 0:h.fontSize)||18})},{default:s(()=>[r(d(u.options.title.text),1)]),_:1},8,["style"]),u.options.title.subtext?(i(),e(y,{key:0,class:"sub-title",style:o({color:(null==(l=u.options.title.subtextStyle)?void 0:l.color)||"#666",fontSize:(null==(c=u.options.title.subtextStyle)?void 0:c.fontSize)||14})},{default:s(()=>[r(d(u.options.title.subtext),1)]),_:1},8,["style"])):a("",!0)]}),_:1},8,["style"])):a("",!0),n(b,{id:g.cid,"canvas-id":g.cid,style:o({width:g.canvasWidth+"px",height:g.canvasHeight+"px"}),onTouchstart:v.tap,onTouchmove:v.move,onTouchend:v.touchEnd},null,8,["id","canvas-id","style","onTouchstart","onTouchmove","onTouchend"])]),_:1},8,["style"])}],["__scopeId","data-v-54ed7deb"]]);const g=t({data:()=>({pieOptions:{title:{text:"Referer of a Website",subtext:"Fake Data",left:"center"},series:[{name:"Nightingale Chart",type:"pie",itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},data:[{name:"分类一",value:30},{name:"分类二",value:25},{name:"分类三",value:20},{name:"分类四",value:15},{name:"分类五",value:10}]}],legend:{show:!0,bottom:20}},pieOptions2:{title:{text:"Referer of a Website",subtext:"Fake Data",left:"center"},series:[{name:"Nightingale Chart",type:"pie",radius:["50%","65%"],itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},data:[{name:"分类一",value:30},{name:"分类二",value:25},{name:"分类三",value:20},{name:"分类四",value:15},{name:"分类五",value:10}]}],legend:{show:!0,bottom:20}}}),methods:{}},[["render",function(t,a,o,d,c,g){const v=l,y=p(u("ly-charts-pie"),f),m=h;return i(),e(m,{class:"u-page"},{default:s(()=>[n(m,{class:"u-page__item"},{default:s(()=>[n(v,{class:"u-page__item__title"},{default:s(()=>[r("基础饼图")]),_:1}),n(m,{class:"u-page__item__content"},{default:s(()=>[n(y,{options:c.pieOptions,width:"750rpx"},null,8,["options"])]),_:1})]),_:1}),n(m,{class:"u-page__item"},{default:s(()=>[n(v,{class:"u-page__item__title"},{default:s(()=>[r("环形饼图")]),_:1}),n(m,{class:"u-page__item__content"},{default:s(()=>[n(y,{options:c.pieOptions2,width:"750rpx"},null,8,["options"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-0dbf61c6"]]);export{g as default};
